project(@DeviceLibrary@_@DriverType@)
cmake_minimum_required(VERSION 3.11)


if (@DriverType@ STREQUAL "Cuda")
    enable_language(CUDA)
    if (@XPU_DEBUG@)
        set(CMAKE_CUDA_FLAGS "${CMAKE_CUDA_FLAGS} --debug --device-debug")
    else()
        add_definitions(-DNDEBUG)
    endif()
    set(CMAKE_CUDA_ARCHITECTURES @CudaArchitectures@)
    set_source_files_properties(@UnitySrcAbsolute@ PROPERTIES LANGUAGE CUDA)
endif()

if ("@DriverType@" STREQUAL "Hip")
    if (@XPU_DEBUG@)
        add_compile_options(-Og -g3)
    else()
        add_compile_options(-O3)
        add_definitions(-DNDEBUG)
    endif()
    # Hip sets some clang flags that results in warnings
    add_compile_options(-Qunused-arguments)
    # set(GPU_TARGETS "gfx906" CACHE STRING "AMD GPU targets to compile for")
    list(APPEND CMAKE_PREFIX_PATH /opt/rocm/hip /opt/rocm)
    find_package(hip)

    # On ROCm hipCUB requires rocPRIM
    find_package(rocprim REQUIRED CONFIG PATHS "/opt/rocm/rocprim")

    # "/opt/rocm" - default install prefix
    find_package(hipcub REQUIRED CONFIG PATHS "/opt/rocm/hipcub")
endif()

set(CMAKE_EXPORT_COMPILE_COMMANDS ON)

include_directories(@IncludeDirectories@)
add_library(@Library@_@DriverType@ MODULE @UnitySrcAbsolute@)

if ("@DriverType@" STREQUAL "Hip")
    target_link_libraries(@Library@_@DriverType@ hip::device hip::hipcub)
endif()
